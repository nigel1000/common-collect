<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="collect.debug.mybatis.test.dao.TestMapper">

    <sql id="tb">
        `test`
    </sql>

    <sql id="cols_all">
        `id`,
        `string_type`,
        `char_type`,
        `mediumtext_type`,
        `datetime_type`,
        `tinyint_type`,
        `smallint_type`,
        `mediumint_type`,
        `int_type`,
        `bigint_type`,
        `double_type`,
        `decimal_type`,
        `bit_type`,
        `date_type`,
        `create_at`,
        `update_at`
    </sql>

    <sql id="vals_all">
        #{item.id},
        #{item.stringType},
        #{item.charType},
        #{item.mediumtextType},
        #{item.datetimeType},
        #{item.tinyintType},
        #{item.smallintType},
        #{item.mediumintType},
        #{item.intType},
        #{item.bigintType},
        #{item.doubleType},
        #{item.decimalType},
        #{item.bitType},
        #{item.dateType},
        <if test="item.createAt != null ">#{item.createAt},</if>
        <if test="item.createAt == null ">now(),</if>
        <if test="item.updateAt != null ">#{item.updateAt}</if>
        <if test="item.updateAt == null ">now()</if>
    </sql>

    <sql id="set_dynamic">
        <if test="item.id !=null">`id` = #{item.id},</if>
        <if test="item.stringType !=null">`string_type` = #{item.stringType},</if>
        <if test="item.charType !=null">`char_type` = #{item.charType},</if>
        <if test="item.mediumtextType !=null">`mediumtext_type` = #{item.mediumtextType},</if>
        <if test="item.datetimeType !=null">`datetime_type` = #{item.datetimeType},</if>
        <if test="item.tinyintType !=null">`tinyint_type` = #{item.tinyintType},</if>
        <if test="item.smallintType !=null">`smallint_type` = #{item.smallintType},</if>
        <if test="item.mediumintType !=null">`mediumint_type` = #{item.mediumintType},</if>
        <if test="item.intType !=null">`int_type` = #{item.intType},</if>
        <if test="item.bigintType !=null">`bigint_type` = #{item.bigintType},</if>
        <if test="item.doubleType !=null">`double_type` = #{item.doubleType},</if>
        <if test="item.decimalType !=null">`decimal_type` = #{item.decimalType},</if>
        <if test="item.bitType !=null">`bit_type` = #{item.bitType},</if>
        <if test="item.dateType !=null">`date_type` = #{item.dateType},</if>
        <if test="item.createAt !=null">`create_at` = #{item.createAt},</if>
        <if test="item.updateAt !=null">`update_at` = #{item.updateAt},</if>
    </sql>

    <insert id="create" parameterType="collect.debug.mybatis.test.domain.Test" keyProperty="item.id"
            useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb"/>
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <include refid="cols_all"/>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <include refid="vals_all"/>
        </trim>
    </insert>

    <insert id="creates" parameterType="list">
        INSERT INTO
        <include refid="tb"/>
        (<include refid="cols_all"/>)
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (<include refid="vals_all"/>)
        </foreach>
    </insert>

    <select id="load" parameterType="long" resultType="collect.debug.mybatis.test.domain.Test">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        WHERE id = #{id}
    </select>

    <select id="loads" resultType="collect.debug.mybatis.test.domain.Test" parameterType="list">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        WHERE id IN
        <foreach collection="list" item="id" index="index" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <delete id="delete" parameterType="long">
        DELETE FROM
        <include refid="tb"/>
        WHERE id = #{id}
    </delete>

    <delete id="deletes" parameterType="list">
        DELETE FROM
        <include refid="tb"/>
        WHERE id IN
        <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <update id="update" parameterType="collect.debug.mybatis.test.domain.Test">
        UPDATE
        <include refid="tb"/>
        <set>
            <include refid="set_dynamic"/>
        </set>
        WHERE id=#{item.id}
    </update>

</mapper>
